function setTotalPrice(){for(var t=$(".product-list .product-item .product-amount"),a=0,e=0;e<t.length;e++){var r;if((r=$(t[e])).val()>0)a+=parseInt(r.parent().prev().attr("data-val"))*(r=r.val())}var n=parseInt($("#total_amount").attr("data-default"))-a;$("#total_amount").attr("data-val",n),$("#total_amount").animateNumbers(n)}function checkBuyButton(t){parseInt(t.parent().prev().attr("data-val"));for(var a=parseInt($("#total_amount").attr("data-val")),e=$(".product-list .product-item .product-price"),r=0;r<e.length;r++)parseInt($(e[r]).attr("data-val"))>a?$(e[r]).next().find(".btn-buy").attr("disabled","disabled"):$(e[r]).next().find(".btn-buy").removeAttr("disabled")}function addCheckout(){for(var t=$(".product-list .product-item .product-amount"),a="",e=0,r=0;r<t.length;r++){if((n=$(t[r])).val()>0){var n,o=n.parent().prev().prev().text(),i=parseInt(n.parent().prev().attr("data-val"));a=a+'<div class="product-name">'+o+'</div><div class="product-amount">x'+(n=n.val())+'</div><div class="product-price">'+currency(i*n)+"</div>";e+=i*n}}$(".checkout-list").html(a),$("#checkout_total").text("£"+e.toLocaleString()),appearCheckout()}function appearCheckout(){$(".checkout-list div").length<1?$(".checkout-panel").hasClass("hidden")||$(".checkout-panel").addClass("hidden"):$(".checkout-panel").removeClass("hidden")}function currency(t){return 999999999<t&&t<1e12?t%1e6!=0?"£"+parseFloat(t/1e9).toFixed(1)+"b":"£"+t/1e9+"b":99999<t&&t<1e9?t%1e6!=0?"£"+parseFloat(t/1e6).toFixed(1)+"m":"£"+t/1e6+"m":999<t&&t<1e6?t%1e3!=0?"£"+parseFloat(t/1e3).toFixed(1)+"k":"£"+t/1e3+"k":t<1e3?"£"+t:void 0}$(document).ready(function(){$(".btn-buy").click(function(){$(this).prev().prev().removeAttr("disabled");var t=$(this).prev().val();t++,$(this).prev().val(t),setTotalPrice(),checkBuyButton($(this)),addCheckout()}),$(".btn-sell").click(function(){var t=$(this).next().val();parseInt(t)>0&&(t--,$(this).next().val(t),setTotalPrice(),checkBuyButton($(this)),addCheckout()),0==t&&$(this).attr("disabled","disabled")}),$(".product-amount").keydown(function(){var t=parseInt($(this).parent().prev().attr("data-val")),a=parseInt($("#total_amount").attr("data-val"))/t;parseInt($(this).val())<1?($(this).val(0),$(this).prev().attr("disabled","disabled")):$(this).val()<=a?($(this).val(parseInt($(this).val())),setTotalPrice(),checkBuyButton($(this)),addCheckout(),$(this).prev().removeAttr("disabled")):($(this).val(parseInt(a)),setTotalPrice(),checkBuyButton($(this)),addCheckout(),$(this).prev().removeAttr("disabled"))}),$("#total_amount").text(parseInt($("#total_amount").attr("data-val")).toLocaleString()),appearCheckout()}),function(t){t.fn.animateNumbers=function(a,e,r,n){return this.each(function(){var o=t(this),i=o.is("input"),l=parseInt(i?o.val().replace(/,/g,""):o.text().replace(/,/g,"")),d=/(\d)(?=(\d\d\d)+(?!\d))/g;e=void 0===e||e,i&&"number"===o[0].type&&(e=!1),t({value:l}).animate({value:a},{duration:void 0===r?1e3:r,easing:void 0===n?"swing":n,step:function(){i?o.val(Math.floor(this.value)):o.text(Math.floor(this.value)),e&&(i?o.val(o.val().replace(d,"$1,")):o.text(o.text().replace(d,"$1,")))},complete:function(){parseInt(o.text())===a&&parseInt(o.val())===a||(i?o.val(a):o.text(a),e&&(i?o.val(o.val().replace(d,"$1,")):o.text(o.text().replace(d,"$1,"))))}})})}}(jQuery);